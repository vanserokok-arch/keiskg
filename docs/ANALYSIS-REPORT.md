# Отчёт по анализу файлов проекта kg

**Дата:** 02.02.2025  
**Объект:** все `index.html`, `styles.css`, `script.js` в корне, fraud, consumer-protection, auto-lawyer.

---

## 1. Заключение: что встретилось

### 1.1 Префиксы и именование (одно и то же под разными именами)

В проекте используются **три разных префикса** для блоков/компонентов:

| Префикс | Где встречается | Примеры |
|--------|------------------|---------|
| **kg-** | Корень, общие блоки | `kg-home`, `kg-glass`, `kg-glass-card`, `kg-stripe-ticker`, `kg-home__card` |
| **keis-** | Header, меню, модалки, тикер, бриджи | `keis-header`, `keis-ticker`, `keis-modal`, `keis-bridge`, `keis-mobile-menu` |
| **kf-** | Секция карточек «признаки» | `kf-flags`, `kf-flag-card`, `kf-flags__row` |

Дополнительно в заголовках используется **k-** без единого стиля:

- **k-title** + **k-title__mark** (BEM: элемент с двойным подчёркиванием)
- **k-title** + **k-title_mark** (одно подчёркивание, визуально модификатор)

В `styles.css` оба варианта заданы вместе (`.k-title__mark, .k-title_mark`), но в HTML они используются **вперемешку**: в одних местах `k-title__mark`, в других `k-title_mark`. Семантически это один и тот же элемент — выделение части заголовка.

**Итог:** Один проект, три «неймспейса» (kg, keis, kf) и два варианта имени для одного элемента (`k-title__mark` / `k-title_mark`).

---

### 1.2 Дубли контента и разметки

- **Тикер (бегущая строка):**
  - В HTML на страницах fraud и consumer-protection есть статичный блок **`.keis-ticker`** с одинаковым набором фраз (8 пунктов).
  - В `script.js` функция `initStripeTicker()` добавляет в первую секцию блок **`.kg-stripe-ticker`** с тем же набором фраз и анимирует его.
  - В CSS блок `.keis-ticker` **глобально скрыт** («keis-ticker: hidden globally per user request»). Фактически показывается только динамический `.kg-stripe-ticker`.
  - **Дублирование:** один и тот же контент задан и в HTML, и в JS; два механизма тикера (старый скрыт, новый активен).

- **Блок кейсов (investment-cases):**
  - На **fraud/index**, **fraud/credit**, **fraud/investment** блок «Наши кейсы» — **полностью одинаковый** (те же 6 кейсов про инвестиции/форекс/крипто и т.д.). На подстраницах credit и investment логичнее было бы показывать кейсы по теме подстраницы или сокращённый набор.

- **Блок FAQ:**
  - Одинаковые вопросы и ответы на fraud/index, fraud/credit, fraud/investment (про договор, обман, сроки, суд, карту физлица, стоимость).

- **Блок «Почему самостоятельно вернуть деньги так сложно» (kg-glass):**
  - Один и тот же текст из 6 карточек (регламенты банков, цепочка переводов, досудебный порядок, доказательства, добровольность, позиция) повторяется на fraud/index, fraud/credit, fraud/investment, fraud/influence. На credit/influence контент мог бы быть специфичным.

- **Header, mobile menu, footer, контактная и success-модалки:**
  - Практически идентичная разметка во всех `index.html`; отличаются только пункты подменю «Сферы защиты» и пути к CSS/JS/assets.

---

### 1.3 Конфликты и несогласованность

- **ID секций и заголовков:**
  - На страницах **consumer-protection** (все 9 подразделов) и **auto-lawyer/imposed-services** для блока «признаки/сигналы» везде используются одни и те же id: **`keisFraudFlagsCredit`** и **`keisFraudFlagsCredit-title`**.
  - В пределах одной страницы ID уникальны, но имя **Credit** не соответствует смыслу страниц (медицина, мебель, страховка и т.д.). Это копипаста с fraud/credit. Для доступности и якорных ссылок лучше уникальные ID (например, по slug: `keisFlagsMedical`, `keisFlagsFurniture` и т.д.).

- **Пути к ассетам:**
  - В подразделах (fraud/credit, fraud/investment, consumer-protection/… ) для логотипа и иконок в шапке используются **относительные** пути: `../../assets/head/head_logo.png`, `../../assets/icons/phonee.png`.
  - В блоке **kg-glass** иконки (s1.png … s6.png) заданы **абсолютно**: `/assets/icons/s1.png` и т.д.
  - Непоследовательность: часть ресурсов от корня, часть относительно текущей страницы. При развёртывании в подкаталог без корня сайта абсолютные пути могут сломаться.

- **data-target для счётчика «дел+»:**
  - На **fraud/index**, **fraud/credit**, **fraud/investment**, **fraud/influence** у блока с `data-bridge-counter="cases"` **нет** атрибута `data-target="1700"`.
  - На **consumer-protection** (включая index и подстраницы) у того же счётчика **есть** `data-target="1700"`.
  - В **consumer-protection/contractor-agreement** и **consumer-goods-refund** у `data-bridge-counter="cases"` снова **нет** `data-target`.
  - Скрипт анимации счётчика может по-разному обрабатывать отсутствие `data-target` (разный финальный результат или отсутствие анимации).

- **Класс body для страниц consumer-protection:**
  - У всех подстраниц consumer-protection (medical-malpractice, furniture-defects, forced-insurance и т.д.) задан **один и тот же** класс **`page-credit`** (скопирован с fraud/credit).
  - При этом `data-page` у каждой свой (medical-malpractice, furniture-defects и т.д.). Класс `page-credit` не отражает тип страницы и может конфликтовать с CSS/логикой, завязанной на тип страницы.

---

### 1.4 Ошибки в разметке и стилях

- **fraud/influence/index.html:**
  - Строка ~434: в заголовке пропущен пробел: `Как идёт<span` → должно быть `Как идёт <span`.
  - В конце файла пустые теги `<script></script>` и `<style></style>` — мусор.

- **consumer-protection/forced-insurance/index.html:**
  - Строка ~500: `Почему добиться возврата<span` — нет пробела перед `<span>`.

- **styles.css:**
  - Строка ~106: после закрытия `@media (max-width: 980px){ ... }` идёт `}.kf-flags` — визуально выглядит как лишняя `}` перед селектором. Фактически это «склеенные» два правила; при желании можно отформатировать в две строки для читаемости.

- **Разная структура тикера:**
  - На большей части страниц: `<div class="keis-ticker"><div class="keis-ticker__track">`.
  - На **consumer-protection/medical-malpractice** и **auto-lawyer** (dkp-termination, imposed-services): `<section class="keis-ticker">` + `keis-ticker__viewport` + `keis-ticker__track`, с классами `keis-ticker__item` и `keis-ticker__sep`. Несогласованность разметки при общем скрытии `.keis-ticker` в CSS.

---

## 2. Критичные и некритичные моменты

### 2.1 Критичные

1. **Абсолютные пути `/assets/icons/s1.png` … в подразделах**  
   При размещении сайта не в корне домена (например, `site.com/kg/`) или при открытии через `file://` эти картинки не загрузятся. Лучше заменить на относительные от текущей страницы (например, `../../assets/icons/s1.png` для fraud/credit и т.п.) или на единый base + относительные пути.

2. **Отсутствие `data-target="1700"` у счётчика «дел+»** на страницах fraud (index, credit, investment, influence) и части consumer-protection (contractor-agreement, consumer-goods-refund)  
   Если скрипт ожидает `data-target` для анимации до 1700, на этих страницах счётчик может не анимироваться или показывать неверное значение. Нужно проверить логику `initBridgeCounters` и при необходимости добавить `data-target="1700"` везде, где показывается «1700 дел+».

3. **Дублирование ID `keisFraudFlagsCredit` / `keisFraudFlagsCredit-title` на многих страницах**  
   В рамках одной страницы ID уникальны, но при использовании якорей или скринридеров одинаковые ID на разных страницах могут путать. Рекомендуется уникальные ID на каждую страницу (например, по data-page или slug).

### 2.2 Некритичные (желательно исправить)

4. **Единый класс body `page-credit` для всех подстраниц consumer-protection**  
   Лучше ввести отдельные классы по типу страницы (например, `page-medical-malpractice`, `page-furniture-defects`) или один общий `page-consumer-subpage`, чтобы не опираться на «credit».

5. **Пробелы перед `<span>` в заголовках** (influence, forced-insurance) и пустые `<script>`/`<style>` во influence — мелкие правки.

6. **Унификация именования:** один префикс для одного слоя (например, оставить kg для «бизнес-блоков», keis для UI: шапка, меню, модалки) и **один** вариант класса для выделения в заголовке: везде либо `k-title__mark`, либо `k-title_mark`, с обновлением CSS под выбранный вариант.

7. **Тикер:** убрать дублирование контента — либо только HTML (и один скрипт тикера, работающий с `.keis-ticker__track`), либо только JS (как сейчас), тогда статичный `.keis-ticker` в HTML можно удалить или оставить пустым/минимальным, чтобы не дублировать фразы.

8. **Контентные дубли:** разные кейсы/FAQ на подстраницах fraud (credit, investment, influence) и, при желании, разный текст kg-glass под тематику подстраницы — улучшит релевантность и SEO, но не ломает функциональность.

---

## 3. Рекомендации: как привести к идеалу

### 3.1 Именование и стили

- **Выбрать один вариант класса для выделения в заголовке:** например, везде использовать `k-title__mark` (BEM) и в CSS оставить только его; во всех HTML заменить `k-title_mark` на `k-title__mark`.
- **Зафиксировать префиксы:** например, `kg-` — лендинговые/контентные блоки (kg-home, kg-glass), `keis-` — общий UI (header, menu, modal, bridge, ticker), `kf-` — секция флагов/карточек. В новых блоках не смешивать префиксы для одного уровня.
- **Классы body:** для consumer-protection подстраниц заменить `page-credit` на уникальный класс по странице (например, `page-medical-malpractice`) или общий `page-consumer-subpage`.

### 3.2 Пути и данные

- **Иконки в kg-glass:** заменить `/assets/icons/s1.png` … на относительные пути в зависимости от глубины страницы (например, в fraud/credit и consumer-protection/medical-malpractice — `../../assets/icons/s1.png`) или ввести один общий способ (например, через base href или переменную в шаблоне).
- **data-target:** во всех блоках с `data-bridge-counter="cases"`, где по дизайну «1700 дел+», добавить `data-target="1700"` и проверить работу счётчика.
- **ID секций:** на каждой странице дать блоку флагов уникальные id, например: `id="keisFlagsMedical"` для medical-malpractice, `id="keisFlagsFurniture"` для furniture-defects, и т.д.; у заголовка — соответствующий `id="keisFlagsMedical-title"` и `aria-labelledby` обновить.

### 3.3 Разметка и мусор

- **fraud/influence:** исправить «Как идёт<span» на «Как идёт <span», удалить пустые `<script></script>` и `<style></style>` в конце.
- **consumer-protection/forced-insurance:** добавить пробел перед `<span>` в заголовке «Почему добиться возврата».
- **styles.css:** при необходимости отформатировать участок с `}.kf-flags` (разнести закрытие медиа и селектор по строкам).

### 3.4 Тикер

- **Вариант A:** Оставить только динамический тикер (как сейчас). Удалить из HTML статичный контент внутри `.keis-ticker` на всех страницах или убрать сам блок `.keis-ticker`, если скрипт полностью создаёт `.kg-stripe-ticker` и не опирается на существующий контейнер.
- **Вариант B:** Отказаться от JS-тикера и оставить один блок `.keis-ticker` в HTML с анимацией через CSS; тогда убрать `initStripeTicker` и класс `.kg-stripe-ticker`, отменить в CSS скрытие `.keis-ticker`.

### 3.5 Долгосрочно

- **Шаблонизация:** вынести header, mobile menu, footer, модалки в общие фрагменты (include, SSI, или сборка), чтобы менять структуру и классы в одном месте.
- **Контент:** для подстраниц fraud (credit, investment, influence) подготовить отдельные кейсы и, при необходимости, FAQ и блок «почему сложно» под тематику страницы.

---

## 4. Краткая сводка

| Категория | Что сделано |
|-----------|-------------|
| **Дубли** | Статичный тикер в HTML и динамический в JS; одинаковые кейсы/FAQ на fraud-подстраницах; один и тот же kg-glass на всех fraud-страницах; общая разметка header/footer/modal. |
| **Конфликты/несогласованность** | Три префикса (kg, keis, kf); два варианта класса (k-title__mark / k-title_mark); смешение абсолютных и относительных путей к assets; один ID секции на многих страницах; разный data-target у счётчика; общий класс body page-credit для всех consumer подстраниц. |
| **Ошибки** | Пропуск пробела в заголовках (influence, forced-insurance); пустые script/style во influence; форматирование в styles.css. |
| **Критично** | Абсолютные пути к иконкам в подразделах; отсутствие data-target у счётчика в части страниц; повторяющиеся ID на разных страницах. |
| **Идеал** | Один стиль именования и один вариант класса для выделения заголовка; относительные или единообразные пути; уникальные ID и корректные data-target; один источник правды для тикера; шаблонизация общих блоков; тематический контент на подстраницах. |
