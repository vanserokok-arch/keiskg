# Финальный разбор проекта kg — дубли, конфликты, рекомендации

**Дата:** 03.02.2026  
**Объект:** все файлы в корневой папке `kg` (index.html во всех папках, styles.css, script.js).

---

## 1. Структура проекта

| Расположение | index.html | Подключение стилей/скриптов |
|--------------|------------|------------------------------|
| **kg/** (корень) | 1 (страница выбора направлений) | `./styles.css`, `./script.js` (без `defer`) |
| **kg/consumer-protection/** | 1 (главная ЗПП) | `../styles.css`, `../script.js` |
| **kg/consumer-protection/** (9 подпапок) | 9 | `../../styles.css`, `../../script.js` |
| **kg/fraud/** | 1 | `../styles.css`, `../script.js` |
| **kg/fraud/** (investment, credit, influence) | 3 | `../../styles.css`, `../../script.js` |
| **kg/auto-lawyer/** (dkp-termination, imposed-services) | 2 | **`/styles.css`**, **`/script.js`** (абсолютные пути) |

**Итого:** 17 страниц index.html, один общий `styles.css` и один `script.js` в корне kg.

---

## 2. Что встретилось: дубли

### 2.1 CSS (styles.css)

- **Один и тот же селектор в нескольких местах (разные медиа/контексты):**
  - `.keis-header-inner` — объявляется в начале файла и многократно в медиа (прим. строки 3681, 3999, 4084, 4120, 4156, 4184, 4236, 40139, 11513, 11577, 11669, 11747, 11952, 11995). Это ожидаемо для адаптива, но «одна правда» для базовых свойств уже вынесена в основной блок; в медиа должны оставаться только отличия.
  - `.hero-investment` — много повторений (4643, 4651, 4760, 4873, 4997, 5076, 5153, 5196, 6391, 10738 и др.). Часть — база, часть — медиа/специфичные страницы; возможна консолидация медиа в один блок по брейкпоинтам.
  - `.investment-faq` — два крупных блока (7946, 8418) + переопределения по страницам (напр. medical-malpractice). Риск конфликта фона уже устранялся (один слой фона).
  - `.trust-parallax`, `.trust-parallax-bg` — несколько определений; антимерцание и слой вынесены в общий блок.
  - `.btn-primary`, `.hero-form .btn-primary` — много вхождений (818, 5763, 6059, 6065, 6159, 8711, 9652, 9687, 9696, 9711, 9757 и др.), в т.ч. с комментариями «REMOVED: конфликтующий блок». Есть дублирование и усложнение каскада.

- **Склеенные правила (форматирование):**  
  Около 40 мест, где закрывающая `}` и следующий селектор или `@media` идут в одной строке (напр. `}.kf-flags {`, `}@media ...`). Не ошибка парсера, но ухудшает читаемость и поиск «одной правды» по блоку.

- **Пустые наборы правил (линтер):**  
  21 предупреждение: «Не используйте пустые наборы правил» (пустые `{ }`) и 2 — «Также определите стандартное свойство background-clip». Строки: 388, 390, 396, 673, 727, 1273, 1343, 1618, 1718, 1948, 2125, 2408, 2521, 3360, 6147, 6744, 6755, 6761, 9749, 9754, 9960.

### 2.2 HTML

- **Тикер:** статичный блок `.keis-ticker` в HTML на части страниц; контент тикера дублируется в `script.js` (initStripeTicker), показывается только динамический `.kg-stripe-ticker`. Дублирование контента и двух механизмов.
- **Header, footer, модалки, форма:** практически одинаковая разметка на всех лендингах; отличаются пункты подменю и пути к ассетам.
- **Блок кейсов (investment-cases):** на fraud/index, fraud/credit, fraud/investment контент кейсов одинаковый.
- **Блок FAQ, блок kg-glass:** одинаковый текст на всех страницах fraud и на consumer-protection подстраницах.

### 2.3 Именование (одно и то же под разными именами)

- **Префиксы блоков:** используются три неймспейса без жёсткого разделения по смыслу:
  - **kg-** — kg-home, kg-glass, kg-stripe-ticker, kg-home__card
  - **keis-** — шапка, меню, модалки, тикер, бриджи
  - **kf-** — секция карточек «признаки» (kf-flags, kf-flag-card)
- **Выделение части заголовка:** в HTML встречаются оба варианта:
  - `k-title__mark` (BEM: двойное подчёркивание)
  - `k-title_mark` (одно подчёркивание)  
  В CSS оба заданы вместе (`.k-title__mark, .k-title_mark`), но семантически это один элемент — лучше оставить один вариант имени.
- **Класс body для подстраниц consumer-protection:** у всех девяти подстраниц один и тот же класс `page-credit` при разных `data-page` (medical-malpractice, furniture-defects и т.д.). «credit» не отражает содержание страницы и может конфликтовать с селекторами, рассчитанными на fraud/credit.

---

## 3. Конфликты и несогласованность

### 3.1 Пути к ресурсам

- **Абсолютные пути от корня сайта:**
  - **auto-lawyer:** `href="/styles.css"`, `src="/script.js"`, `src="/assets/head/head_logo.png"`, ссылка логотипа `href="/dkp-termination/"`. При размещении сайта не в корне (например, `site.com/kg/`) стили, скрипты и навигация сломаются.
  - **Все подстраницы (consumer-protection, fraud):** favicon и иконки в блоке kg-glass — `href="/favicon.ico"`, `src="/assets/icons/s1.png"` … `s6.png`. При деплое в подкаталог без корня эти ресурсы не загрузятся.
- **Относительные пути:** в шапке и контенте подстраниц используются `../` и `../../` к `assets/`, `styles.css`, `script.js` — они корректны при открытии из соответствующей глубины.

**Итог:** смешение абсолютных и относительных путей; абсолютные критичны при деплое не в корень.

### 3.2 data-page и классы body

- **fraud/investment, fraud/credit, fraud/influence:** у `<body>` заданы только классы (`page-investment`, `page-credit`, `page-influence`), атрибута **`data-page` нет**. Остальные страницы используют `data-page` (consumer-protection, complaint-against-lawyer и т.д.). Скрипты или стили, опирающиеся на `data-page`, на этих трёх страницах могут вести себя иначе.
- **consumer-protection:** все подстраницы имеют `class="page-credit"` и уникальный `data-page`. Класс `page-credit` общий и не отражает тематику (медицина, мебель, страховка и т.д.).

### 3.3 ID секций

- На всех страницах consumer-protection (включая подразделы) и на auto-lawyer/imposed-services для блока «признаки/сигналы» используются одни и те же id: **`keisFraudFlagsCredit`** и **`keisFraudFlagsCredit-title`** (на главной ЗПП — `keisFraudFlagsMain-title`). В пределах одной страницы ID уникальны, но имя «Credit» не соответствует смыслу страниц; при якорных ссылках и доступности лучше уникальные ID (например, по slug страницы).

### 3.4 Счётчик «дел+»

- На страницах fraud (index, credit, investment, influence) и на части consumer-protection у блока с `data-bridge-counter="cases"` **нет** атрибута `data-target="1700"`.
- На остальных consumer-protection страницах `data-target="1700"` есть. Логика initBridgeCounters может давать разный результат или не анимировать счётчик там, где target не задан.

### 3.5 Скрипт на главной (корень kg)

- В **kg/index.html** скрипт подключён **без `defer`**: `<script src="./script.js"></script>`. На всех остальных страницах — с `defer`. Разное поведение по порядку выполнения и блокировке рендера.

---

## 4. Критичные и некритичные моменты

### 4.1 Критичные

1. **Абсолютные пути в auto-lawyer** (`/styles.css`, `/script.js`, `/assets/...`, `/dkp-termination/`) — при размещении не в корне домена страницы auto-lawyer не загрузят стили/скрипты и навигация сломается. Нужны относительные пути от текущей страницы (например, `../../styles.css` для auto-lawyer/dkp-termination).
2. **Абсолютные пути к иконкам kg-glass** (`/assets/icons/s1.png` … s6.png) и к favicon на всех подстраницах — при деплое в подкаталог картинки не отобразятся. Заменить на относительные от глубины страницы или единый base.
3. **Отсутствие `data-page`** на fraud/investment, fraud/credit, fraud/influence — если логика (JS/CSS) завязана на `data-page`, на этих страницах будет рассогласование. Добавить `data-page="investment"`, `data-page="credit"`, `data-page="influence"` соответственно.
4. **Повторяющиеся ID** `keisFraudFlagsCredit` / `keisFraudFlagsCredit-title` на многих страницах — при переходе по якорям и для доступности лучше уникальные ID на каждую страницу (например, по data-page или slug).

### 4.2 Некритичные (желательно исправить)

5. **Единый класс body `page-credit`** для всех подстраниц consumer-protection — заменить на отдельные классы по типу страницы (например, `page-medical-malpractice`) или один общий `page-consumer-subpage`.
6. **Два варианта класса для выделения в заголовке** (`k-title__mark` и `k-title_mark`) — унифицировать в один (например, везде `k-title__mark`) и в CSS оставить один селектор.
7. **Пустые правила и background-clip в styles.css** — удалить пустые блоки `{ }`, добавить стандартное свойство `background-clip` рядом с `-webkit-background-clip`; отформатировать «склеенные» `}.selector` и `}@media` для читаемости.
8. **Дублирование контента тикера** (HTML + JS) — оставить один источник: либо только генерация в JS (как сейчас), тогда статичный контент в `.keis-ticker` убрать или очистить; либо один HTML-тикер с одним скриптом.
9. **Комментарии «REMOVED: конфликтующий блок»** в styles.css — после консолидации стилей кнопок (CTA, .btn-primary) убрать мёртвые комментарии и лишние селекторы, чтобы не путать при правках.
10. **Подключение script.js на главной** — для единообразия добавить `defer`: `<script src="./script.js" defer></script>` в kg/index.html.
11. **data-target у счётчика «дел+»** — везде, где по дизайну отображается «1700 дел+», добавить `data-target="1700"` и проверить работу initBridgeCounters.

---

## 5. Как привести к идеалу

### 5.1 Пути

- **auto-lawyer:** заменить `/styles.css` → `../../styles.css`, `/script.js` → `../../script.js`, `/assets/...` → `../../assets/...`, ссылку логотипа — на относительную (например, `../` или `../../` в зависимости от структуры).
- **Иконки kg-glass и favicon:** на подстраницах consumer-protection и fraud заменить `/assets/icons/sN.png` на `../../assets/icons/sN.png` (или `../assets/...` для страниц первого уровня); favicon — на относительные пути от текущей страницы или использовать один `<base href="...">` при сборке/шаблонизации.

### 5.2 Разметка и атрибуты

- **fraud:** добавить на `<body>` атрибуты `data-page="investment"`, `data-page="credit"`, `data-page="influence"` соответственно.
- **consumer-protection подстраницы:** заменить `class="page-credit"` на уникальный класс по странице (например, `page-medical-malpractice`) или общий `page-consumer-subpage`.
- **ID секций «признаки»:** на каждой странице задать уникальные id (например, `keisFlagsMedical`, `keisFlagsFurniture` и т.д.) и соответствующие `id` у заголовков + `aria-labelledby`.
- **Счётчик:** во всех блоках с `data-bridge-counter="cases"`, где показывается «1700 дел+», добавить `data-target="1700"`.
- **kg/index.html:** добавить `defer` к подключению script.js.

### 5.3 Стили (styles.css)

- **Одна правда на блок:** для каждого крупного блока (header, hero-investment, investment-faq, trust-parallax, btn-primary и т.д.) держать базовые свойства в одном месте; в медиа и контекстных селекторах — только отличия. Уже сделано для антимерцания секций и части header/FAQ; продолжить для .hero-investment и .btn-primary/.hero-form.
- **Пустые правила:** удалить пустые блоки по номерам строк из отчёта линтера.
- **background-clip:** рядом с `-webkit-background-clip` добавить `background-clip`.
- **Форматирование:** разнести «склеенные» `}.selector` и `}@media` на отдельные строки для удобства поиска и правок.
- **Именование:** оставить один класс выделения заголовка (например, `k-title__mark`) и обновить все HTML и CSS.

### 5.4 Контент и тикер

- **Тикер:** либо убрать статичный контент из `.keis-ticker` в HTML (оставив только контейнер при необходимости), либо перейти на один механизм без дублирования фраз в JS.
- **Кейсы/FAQ/kg-glass:** при желании развести контент по подстраницам fraud и consumer-protection под тематику страницы — для релевантности и SEO.

### 5.5 Долгосрочно

- **Шаблонизация:** вынести header, footer, модалки, общие блоки в переиспользуемые фрагменты (SSI, сборка, шаблонизатор), чтобы пути и разметка задавались в одном месте.
- **Единый способ путей:** зафиксировать стратегию (все относительные от страницы, или base + относительные) и применять её ко всем новым страницам и ассетам.

---

## 6. Краткая сводка

| Категория | Что есть |
|-----------|----------|
| **Дубли** | Многократные объявления одних и тех же селекторов в CSS (header, hero, faq, trust, btn-primary); дублирование контента тикера в HTML и JS; одинаковые кейсы/FAQ/kg-glass на многих страницах; общая разметка header/footer/modal. |
| **Конфликты/несогласованность** | Три префикса (kg, keis, kf); два варианта класса (k-title__mark / k-title_mark); смешение абсолютных и относительных путей; общий класс page-credit для всех consumer подстраниц; отсутствие data-page на fraud/investment, credit, influence; разные data-target у счётчика; абсолютные пути в auto-lawyer. |
| **Ошибки/качество** | Пустые правила и отсутствие background-clip в CSS; склеенные строки в CSS; script без defer на главной. |
| **Критично** | Абсолютные пути в auto-lawyer и к иконкам/favicon при деплое не в корень; отсутствие data-page на трёх страницах fraud; повторяющиеся ID на разных страницах. |
| **Идеал** | Один стиль именования и один класс для выделения заголовка; относительные или единообразные пути; уникальные ID и корректные data-page/data-target; одна «правда» на блок в CSS; один источник контента тикера; шаблонизация общих блоков. |

---

Документ опирается на существующий `docs/ANALYSIS-REPORT.md` и на повторный разбор всех index.html, styles.css и script.js в папке kg.
